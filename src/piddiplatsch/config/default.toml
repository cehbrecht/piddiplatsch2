[consumer]
processor = "cmip6"
topic = "CMIP6"
output_dir = "outputs"
 # Maximum number of errors before stopping; -1 = unlimited.
 max_errors = 10

[consumer.transient]
 # --- Transient External Failures (STAC/network) ---
 # Stop consumption on transient failures after bounded retries.
 # Override at runtime with the CLI flag --force to continue.
 stop_on_skip = true
 # Number of retry attempts for transient PATCH fetch failures.
 retries = 3
 # Initial backoff delay (seconds) for transient retries.
 backoff_initial = 0.5
 # Maximum backoff delay (seconds) for transient retries.
 backoff_max = 5.0
 # Probe STAC health at startup; if unhealthy and not forced, exit early (fail-fast).
 preflight_stac = true

[kafka]
"bootstrap.servers" = "localhost:39092"
"group.id" = "piddiplatsch-001"
"auto.offset.reset" = "earliest"
"enable.auto.commit" = true

# Best practice for higher availability in librdkafka clients prior to 1.7
"session.timeout.ms" = 45000

# Note: dotted librdkafka keys are quoted to keep them as literal TOML keys.

[handle]
# backend = "jsonl"
backend = "pyhandle"
server_url = "http://localhost:8000"
prefix = "21.TEST"
username = "300:21.TEST/testuser"
password = "testpass"

[stac]
base_url = "https://api.stac.esgf.ceda.ac.uk"
timeout = 10
collection = "cmip6"

[elasticsearch]
base_url = "http://elastic-hippo.cloud.dkrz.de:9200"
index = "handle_21t14995"

[schema]
strict_mode = true

[plugins.cmip6]
# Base URL for landing pages used to construct dataset/file URLs
landing_page_url = "https://handle-esgf.dkrz.de/lp"

# Limit the number of HAS_PARTS entries; -1 for unlimited
max_parts = -1

# Asset keys to exclude from HAS_PARTS generation
excluded_asset_keys = ["reference_file", "globus", "thumbnail", "quicklook"]

# Preferred asset keys to resolve host and published_on (optional)
# preferred_asset_keys = ["reference_file", "data0000", "data0001"]

# Enable previous-version lookup (optional; default: true)
# enable_previous_version_lookup = true

[lookup]
# Backend to use for lookups ("stac" or "es")
backend = "stac"
enabled = true

[stats]
# Log interval (seconds) for console/DB reporters
interval_seconds = 10

# Message count threshold before logging a stats snapshot
summary_interval = 1000

# Enable SQLite reporter for persistent stats
enable_db = true

# Path to SQLite database file (used only if enable_db = true)
db_path = "stats.db"
