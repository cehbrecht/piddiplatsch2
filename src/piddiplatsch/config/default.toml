[consumer]
processor = "cmip6"
topic = "CMIP6"
output_dir = "outputs"
max_errors = 10  # -1 = unlimited, any positive int = stop after that many
 # --- Transient External Failure Handling (STAC/network) ---
 # stop_on_transient_skip: if true, stop consumption on transient external failures
 #   (e.g., STAC unreachable/timeouts/HTTP 5xx) after bounded retries.
 #   Override at runtime with the CLI flag --force to continue.
 stop_on_transient_skip = true
 # transient_retries: number of attempts for transient fetch failures (PATCH fetch).
 transient_retries = 3
 # transient_backoff_initial: initial backoff delay in seconds for retries.
 transient_backoff_initial = 0.5
 # transient_backoff_max: maximum backoff delay in seconds.
 transient_backoff_max = 5.0
 # preflight_stac: probe STAC health at startup; if unhealthy and not forced,
 #   the consumer exits early (fail-fast).
 preflight_stac = true

[kafka]
"bootstrap.servers" = "localhost:39092"
"group.id" = "piddiplatsch-001"
"auto.offset.reset" = "earliest"
"enable.auto.commit" = true

# Best practice for higher availability in librdkafka clients prior to 1.7
"session.timeout.ms" = 45000

[handle]
# backend = "jsonl"
backend = "pyhandle"
server_url = "http://localhost:8000"
prefix = "21.TEST"
username = "300:21.TEST/testuser"
password = "testpass"

[stac]
base_url = "https://api.stac.esgf.ceda.ac.uk"
timeout = 10
collection = "cmip6"

[elasticsearch]
base_url = "http://elastic-hippo.cloud.dkrz.de:9200"
index = "handle_21t14995"

[schema]
strict_mode = true

[plugins.cmip6]
# Base URL for landing pages used to construct dataset and file URLs
landing_page_url = "https://handle-esgf.dkrz.de/lp"

# Limit the number of HAS_PARTS entries; -1 for unlimited
max_parts = -1

# Asset keys to exclude from HAS_PARTS generation
excluded_asset_keys = ["reference_file", "globus", "thumbnail", "quicklook"]

# Preferred asset keys to resolve host and published_on (optional)
# preferred_asset_keys = ["reference_file", "data0000", "data0001"]

# Enable previous-version lookup (optional; default true)
# enable_previous_version_lookup = true

[lookup]
backend = "stac" # or "es"
enabled = true

[stats]
# Interval in seconds for logging stats (console + DB)
interval_seconds = 10

# Number of messages processed before logging stats
summary_interval = 1000

# Enable SQLite reporter for persistent stats
enable_db = true

# Path to SQLite database file (only used if enable_db = true)
db_path = "stats.db"
